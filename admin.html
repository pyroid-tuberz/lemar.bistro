<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lemar Bistro - Admin Panel</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        h1,
        h2 {
            color: #333;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        input[type="text"],
        input[type="password"],
        textarea,
        select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }

        button {
            background-color: #FFC700;
            color: #000;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
            border-radius: 4px;
            font-weight: bold;
        }

        button:hover {
            background-color: #e6b400;
        }

        button.delete-btn {
            background-color: #ff4444;
            color: white;
        }

        button.edit-btn {
            background-color: #444;
            color: white;
            margin-right: 5px;
        }

        .login-screen {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }

        .dashboard {
            display: none;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        th,
        td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        th {
            background-color: #f8f8f8;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 100;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
        }

        .modal-content {
            background-color: #fff;
            margin: 10% auto;
            padding: 20px;
            border-radius: 8px;
            width: 50%;
            max-width: 500px;
        }

        .close {
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
    </style>
</head>

<body>

    <!-- Login Screen -->
    <div id="login-screen" class="login-screen">
        <div class="container" style="width: 300px;">
            <h2>Admin Giri≈üi</h2>
            <form id="login-form">
                <div class="form-group">
                    <label>Kullanƒ±cƒ± Adƒ±</label>
                    <input type="text" id="username" required>
                </div>
                <div class="form-group">
                    <label>≈ûifre</label>
                    <input type="password" id="password" required>
                </div>
                <button type="submit" style="width: 100%">Giri≈ü Yap</button>
            </form>
        </div>
    </div>

    <!-- Dashboard -->
    <div id="dashboard" class="dashboard">
        <div class="container">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h1>Y√∂netim Paneli</h1>
                <div>
                    <button onclick="switchTab('menu')">Men√º</button>
                    <button onclick="switchTab('gallery')">Galeri</button>
                    <button onclick="switchTab('category')">Kategoriler</button>
                    <button onclick="switchTab('background')">Arkaplan</button>
                </div>
            </div>

            <!-- MENU TAB -->
            <div id="menu-tab">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <h2>Men√º Y√∂netimi</h2>
                    <button onclick="openModal()">+ Yeni √úr√ºn Ekle</button>
                </div>

                <div class="form-group">
                    <input type="text" id="search-box" placeholder="√úr√ºn Ara...">
                </div>

                <table>
                    <thead>
                        <tr>
                            <th>√úr√ºn Adƒ±</th>
                            <th>Kategori</th>
                            <th>Fiyat</th>
                            <th>ƒ∞≈ülemler</th>
                        </tr>
                    </thead>
                    <tbody id="items-table-body">
                        <!-- Items will be injected here -->
                    </tbody>
                </table>
            </div>

            <!-- GALLERY TAB -->
            <div id="gallery-tab" style="display: none;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <h2>Galeri Y√∂netimi</h2>
                    <button onclick="openGalleryModal()">+ Fotoƒüraf Y√ºkle</button>
                </div>
                <div id="gallery-grid"
                    style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; margin-top: 20px;">
                    <!-- Images will be injected here -->
                </div>
            </div>

            <!-- CATEGORY TAB -->
            <div id="category-tab" style="display: none;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <h2>Kategori Y√∂netimi</h2>
                    <button onclick="openCategoryModal()">+ Yeni Kategori</button>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>Adƒ±</th>
                            <th>√úst Men√º</th>
                            <th>Renk</th>
                            <th>G√∂r√ºn√ºm</th>
                            <th>ƒ∞≈ülemler</th>
                        </tr>
                    </thead>
                    <tbody id="categories-table-body">
                        <!-- Categories injected here -->
                    </tbody>
                </table>
            </div>

            <!-- BACKGROUND TAB -->
            <div id="background-tab" style="display: none;">
                <h2>Arkaplan Y√∂netimi</h2>
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-top:20px;">
                    <div class="bg-card">
                        <h3>Sabah (06:00 - 12:00)</h3>
                        <img id="bg-img-sabah" src=""
                            style="width:100%; height:150px; object-fit:cover; border-radius:8px; margin-bottom:10px;">
                        <form onsubmit="updateBackground(event, 'sabah')">
                            <input type="file" name="image" required accept="image/*">
                            <button type="submit" style="margin-top:5px; width:100%;">Deƒüi≈ütir</button>
                        </form>
                        <button onclick="resetBackground('sabah')"
                            style="width:100%; margin-top:5px; background:#ff4444;">Varsayƒ±lan</button>
                    </div>
                    <div class="bg-card">
                        <h3>√ñƒüle (12:00 - 18:00)</h3>
                        <img id="bg-img-oglen" src=""
                            style="width:100%; height:150px; object-fit:cover; border-radius:8px; margin-bottom:10px;">
                        <form onsubmit="updateBackground(event, 'oglen')">
                            <input type="file" name="image" required accept="image/*">
                            <button type="submit" style="margin-top:5px; width:100%;">Deƒüi≈ütir</button>
                        </form>
                        <button onclick="resetBackground('oglen')"
                            style="width:100%; margin-top:5px; background:#ff4444;">Varsayƒ±lan</button>
                    </div>
                    <div class="bg-card">
                        <h3>Ak≈üam (18:00 - 06:00)</h3>
                        <img id="bg-img-aksam" src=""
                            style="width:100%; height:150px; object-fit:cover; border-radius:8px; margin-bottom:10px;">
                        <form onsubmit="updateBackground(event, 'aksam')">
                            <input type="file" name="image" required accept="image/*">
                            <button type="submit" style="margin-top:5px; width:100%;">Deƒüi≈ütir</button>
                        </form>
                        <button onclick="resetBackground('aksam')"
                            style="width:100%; margin-top:5px; background:#ff4444;">Varsayƒ±lan</button>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <!-- Add/Edit Modal -->
    <div id="item-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h2 id="modal-title">√úr√ºn Ekle</h2>
            <form id="item-form">
                <input type="hidden" id="item-id">
                <div class="form-group">
                    <label>Kategori</label>
                    <div style="display:flex; gap:5px;">
                        <select id="item-category" required style="flex-grow:1;">
                            <!-- Categories injected via JS -->
                        </select>
                        <button type="button" onclick="openCategoryModal()"
                            style="width:auto; padding:0 10px;">+</button>
                    </div>
                </div>
                <div class="form-group">
                    <label>√úr√ºn Adƒ±</label>
                    <input type="text" id="item-name" required>
                </div>
                <div class="form-group">
                    <label>A√ßƒ±klama</label>
                    <textarea id="item-description" rows="3"></textarea>
                </div>

                <div class="form-group">
                    <label>Fiyat</label>
                    <input type="text" id="item-price" required>
                </div>

                <button type="submit" style="width: 100%">Kaydet</button>
            </form>
        </div>
    </div>

    <!-- Category Modal -->
    <div id="category-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeCategoryModal()">&times;</span>
            <h2 id="cat-modal-title">Kategori Y√∂netimi</h2>
            <form id="category-form">
                <input type="hidden" id="cat-id">
                <div class="form-group">
                    <label>Kategori Adƒ±</label>
                    <input type="text" id="cat-name" required>
                </div>
                <div class="form-group">
                    <label>√úst Men√º (Parent)</label>
                    <select id="cat-parent">
                        <!-- Injected JS -->
                    </select>
                </div>
                <div class="form-group">
                    <label>Renk</label>
                    <input type="color" id="cat-color" value="#FFC700" style="width:100%; height:40px;">
                </div>
                <div class="form-group">
                    <label>B√ºy√ºkl√ºk</label>
                    <select id="cat-size">
                        <option value="normal">Normal</option>
                        <option value="large">B√ºy√ºk (Vurgulu)</option>
                    </select>
                </div>
                <button type="submit" style="width: 100%">Kaydet</button>
            </form>
        </div>
    </div>

    <!-- Gallery Upload Modal -->
    <div id="gallery-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeGalleryModal()">&times;</span>
            <h2>Fotoƒüraf Y√ºkle</h2>
            <form id="gallery-form">
                <div class="form-group">
                    <label>Fotoƒüraf Se√ß</label>
                    <input type="file" id="gallery-file" accept="image/*" required>
                </div>
                <div class="form-group">
                    <label>G√∂r√ºnt√ºlenecek Zamanlar</label>
                    <div>
                        <input type="checkbox" id="time-sabah" value="sabah"> <label style="display:inline"
                            for="time-sabah">Sabah</label>
                        <input type="checkbox" id="time-oglen" value="oglen"> <label style="display:inline"
                            for="time-oglen">√ñƒülen</label>
                        <input type="checkbox" id="time-aksam" value="aksam"> <label style="display:inline"
                            for="time-aksam">Ak≈üam</label>
                    </div>
                </div>
                <button type="submit" style="width: 100%">Y√ºkle</button>
            </form>
        </div>
    </div>

    <script>
        const API_URL = '/api';
        let token = localStorage.getItem('adminToken');
        let menuData = { items: [], categories: {} };

        // DOM Elements
        const loginScreen = document.getElementById('login-screen');
        const dashboard = document.getElementById('dashboard');
        const loginForm = document.getElementById('login-form');
        const tableBody = document.getElementById('items-table-body');
        const modal = document.getElementById('item-modal');
        const itemForm = document.getElementById('item-form');
        const searchBox = document.getElementById('search-box');

        // Gallery Elements
        const galleryGrid = document.getElementById('gallery-grid');
        const galleryModal = document.getElementById('gallery-modal');
        const galleryForm = document.getElementById('gallery-form');

        // Login Logic
        if (token) showDashboard();

        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const username = e.target.username.value;
            const password = e.target.password.value;

            try {
                const res = await fetch(`${API_URL}/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, password })
                });

                if (res.ok) {
                    const data = await res.json();
                    token = data.token;
                    localStorage.setItem('adminToken', token);
                    showDashboard();
                } else {
                    alert('Giri≈ü ba≈üarƒ±sƒ±z!');
                }
            } catch (err) {
                console.error(err);
                alert('Bir hata olu≈ütu.');
            }
        });

        // Item Form Submit (Auto-append ‚Ç∫)
        itemForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const id = document.getElementById('item-id').value;
            let price = document.getElementById('item-price').value.trim();

            // Auto-append ‚Ç∫ if not present
            if (price && !price.includes('‚Ç∫')) {
                price += ' ‚Ç∫';
            }

            const item = {
                id: id || Date.now().toString(), // Simple ID gen if new
                category: document.getElementById('item-category').value,
                name: document.getElementById('item-name').value,
                description: document.getElementById('item-description').value,
                price: price
            };

            try {
                const res = await fetch(`${API_URL}/menu/item`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` },
                    body: JSON.stringify({ item })
                });
                if (res.ok) {
                    closeModal();
                    loadMenu();
                } else { alert('Kaydedilemedi'); }
            } catch (err) { console.error(err); }
        });

        function showDashboard() {
            loginScreen.style.display = 'none';
            dashboard.style.display = 'block';
            loadMenu();
            loadGallery();
            loadBackgrounds();
            switchTab('menu'); // Default to menu tab
        }

        function switchTab(tab) {
            document.getElementById('menu-tab').style.display = tab === 'menu' ? 'block' : 'none';
            document.getElementById('gallery-tab').style.display = tab === 'gallery' ? 'block' : 'none';
            document.getElementById('category-tab').style.display = tab === 'category' ? 'block' : 'none';
            document.getElementById('background-tab').style.display = tab === 'background' ? 'block' : 'none';
        }

        // --- BACKGROUND LOGIC ---
        async function loadBackgrounds() {
            try {
                const res = await fetch(`${API_URL}/backgrounds`);
                const data = await res.json();
                document.getElementById('bg-img-sabah').src = data.sabah;
                document.getElementById('bg-img-oglen').src = data.oglen;
                document.getElementById('bg-img-aksam').src = data.aksam;

                // Populate times
                const times = data.times || { sabah: 6, oglen: 12, aksam: 18 };
                document.getElementById('time-start-sabah').value = times.sabah;
                document.getElementById('time-start-oglen').value = times.oglen;
                document.getElementById('time-start-aksam').value = times.aksam;

                updateLabels(times);
            } catch (err) { console.error(err); }
        }

        function updateLabels(times) {
            document.getElementById('label-sabah').textContent = `Sabah (${times.sabah}:00 - ${times.oglen}:00)`;
            document.getElementById('label-oglen').textContent = `√ñƒüle (${times.oglen}:00 - ${times.aksam}:00)`;
            document.getElementById('label-aksam').textContent = `Ak≈üam (${times.aksam}:00 - ${times.sabah}:00)`;
        }

        async function saveTimeSlots() {
            const times = {
                sabah: document.getElementById('time-start-sabah').value,
                oglen: document.getElementById('time-start-oglen').value,
                aksam: document.getElementById('time-start-aksam').value
            };

            try {
                const res = await fetch(`${API_URL}/background/times`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` },
                    body: JSON.stringify({ times })
                });
                if (res.ok) {
                    alert('Saatler g√ºncellendi!');
                    const data = await res.json();
                    updateLabels(data.times);
                }
            } catch (err) { console.error(err); }
        }

        async function updateBackground(e, slot) {
            e.preventDefault();
            const formData = new FormData(e.target);
            formData.append('timeSlot', slot);

            try {
                const res = await fetch(`${API_URL}/background`, {
                    method: 'POST',
                    headers: { 'Authorization': `Bearer ${token}` },
                    body: formData
                });
                if (res.ok) {
                    alert('Arkaplan g√ºncellendi!');
                    loadBackgrounds();
                } else { alert('Hata olu≈ütu'); }
            } catch (err) { console.error(err); }
        }

        async function resetBackground(slot) {
            if (!confirm('Varsayƒ±lan g√∂rseline d√∂n√ºls√ºn m√º?')) return;
            try {
                const res = await fetch(`${API_URL}/background/reset`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` },
                    body: JSON.stringify({ timeSlot: slot })
                });
                if (res.ok) {
                    loadBackgrounds();
                }
            } catch (err) { console.error(err); }
        }

        // --- MENU LOGIC ---
        async function loadMenu() {
            const res = await fetch(`${API_URL}/menu`);
            menuData = await res.json();
            renderTable(menuData.items);
            populateCategories(menuData.categories);
            renderCategoryTable(menuData.categories); // Also render category tab
        }

        function populateCategories(categories) {
            const select = document.getElementById('item-category');
            select.innerHTML = '';
            // categories is now object: { id: {name, ...} }
            for (const [id, data] of Object.entries(categories)) {
                if (id === 'root') continue; // Don't add items to root directly usually
                const option = document.createElement('option');
                option.value = id;
                option.textContent = data.name || data; // Handle both old string and new object
                select.appendChild(option);
            }
        }

        // --- CATEGORY TAB LOGIC ---
        const catModal = document.getElementById('category-modal');
        const catForm = document.getElementById('category-form');

        function renderCategoryTable(categories) {
            const tbody = document.getElementById('categories-table-body');
            tbody.innerHTML = '';

            for (const [id, data] of Object.entries(categories)) {
                if (id === 'root') continue;
                const row = document.createElement('tr');
                const parentName = categories[data.parent]?.name || 'Men√º (Root)';
                row.innerHTML = `
                    <td>${data.name}</td>
                    <td>${parentName}</td>
                    <td><div style="width:20px; height:20px; background:${data.color}; border-radius:50%;"></div></td>
                    <td>${data.size}</td>
                    <td>
                        <button onclick='editCategory("${id}")'>D√ºzenle</button>
                        <button class="delete-btn" onclick='deleteCategory("${id}")' style="background-color: #ff4444; color: white;">X</button>
                    </td>
                `;
                tbody.appendChild(row);
            }
        }

        window.openCategoryModal = () => {
            catForm.reset();
            document.getElementById('cat-id').value = '';
            populateParentSelect();
            catModal.style.display = 'block';
        };

        window.closeCategoryModal = () => {
            catModal.style.display = 'none';
        };

        window.editCategory = (id) => {
            const data = menuData.categories[id];
            document.getElementById('cat-id').value = id;
            document.getElementById('cat-name').value = data.name;
            populateParentSelect();
            document.getElementById('cat-parent').value = data.parent || 'root';
            document.getElementById('cat-color').value = data.color || '#FFC700';
            document.getElementById('cat-size').value = data.size || 'normal';
            catModal.style.display = 'block';
        };

        window.deleteCategory = async (id) => {
            if (!confirm('Bu kategoriyi silmek istediƒüinize emin misiniz?')) return;
            try {
                const res = await fetch(`${API_URL}/category/${id}`, {
                    method: 'DELETE',
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                if (res.ok) {
                    loadMenu();
                } else {
                    alert('Silinemedi.');
                }
            } catch (err) { console.error(err); }
        };

        function populateParentSelect() {
            const select = document.getElementById('cat-parent');
            select.innerHTML = '<option value="root">Men√º (Root)</option>';
            for (const [id, data] of Object.entries(menuData.categories)) {
                if (id !== 'root') {
                    const option = document.createElement('option');
                    option.value = id;
                    option.textContent = data.name;
                    select.appendChild(option);
                }
            }
        }

        catForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const id = document.getElementById('cat-id').value ||
                document.getElementById('cat-name').value.toLowerCase().replace(/[^a-z0-9]/g, '-').replace(/-+/g, '-');

            const payload = {
                id: id,
                name: document.getElementById('cat-name').value,
                parent: document.getElementById('cat-parent').value,
                color: document.getElementById('cat-color').value,
                size: document.getElementById('cat-size').value
            };

            try {
                const res = await fetch(`${API_URL}/category`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` },
                    body: JSON.stringify(payload)
                });
                if (res.ok) {
                    closeCategoryModal();
                    loadMenu();
                }
            } catch (err) { console.error(err); }
        });

        function renderTable(items) {
            tableBody.innerHTML = '';
            items.forEach(item => {
                const row = document.createElement('tr');
                const catName = menuData.categories[item.category]?.name || menuData.categories[item.category];
                row.innerHTML = `
                    <td>${item.name}</td>
                    <td>${catName}</td>
                    <td>${item.price}</td>
                    <td>
                        <button class="edit-btn" onclick='editItem(${JSON.stringify(item)})'>D√ºzenle</button>
                        <button class="delete-btn" onclick="deleteItem('${item.id}')">Sil</button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        // Search
        searchBox.addEventListener('input', (e) => {
            const term = e.target.value.toLowerCase();
            const filtered = menuData.items.filter(item =>
                item.name.toLowerCase().includes(term) ||
                (item.description && item.description.toLowerCase().includes(term))
            );
            renderTable(filtered);
        });

        // Modal Logic
        window.openModal = () => {
            itemForm.reset();
            document.getElementById('item-id').value = '';
            document.getElementById('modal-title').textContent = '√úr√ºn Ekle';
            modal.style.display = 'block';
        };

        window.closeModal = () => {
            modal.style.display = 'none';
        };

        window.editItem = (item) => {
            document.getElementById('item-id').value = item.id;
            document.getElementById('item-category').value = item.category;
            document.getElementById('item-name').value = item.name;
            document.getElementById('item-description').value = item.description || '';
            document.getElementById('item-price').value = item.price;

            document.getElementById('modal-title').textContent = '√úr√ºn D√ºzenle';
            modal.style.display = 'block';
        };

        // Save Item
        itemForm.addEventListener('submit', async (e) => {
            e.preventDefault();

            let price = document.getElementById('item-price').value.trim();
            if (price && !price.includes('‚Ç∫')) {
                price += ' ‚Ç∫';
            }

            const item = {
                id: document.getElementById('item-id').value || null,
                category: document.getElementById('item-category').value,
                name: document.getElementById('item-name').value,
                description: document.getElementById('item-description').value,
                price: price
            };

            try {
                const res = await fetch(`${API_URL}/menu/item`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({ item })
                });

                if (res.ok) {
                    closeModal();
                    loadMenu();
                } else {
                    alert('Kaydedilemedi.');
                }
            } catch (err) {
                console.error(err);
            }
        });

        // Delete Item
        window.deleteItem = async (id) => {
            if (!confirm('Bu √ºr√ºn√º silmek istediƒüinize emin misiniz?')) return;

            try {
                const res = await fetch(`${API_URL}/menu/item/${id}`, {
                    method: 'DELETE',
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                if (res.ok) {
                    loadMenu();
                }
            } catch (err) {
                console.error(err);
            }
        };

        // --- GALLERY LOGIC ---

        async function loadGallery() {
            const res = await fetch(`${API_URL}/gallery`);
            const data = await res.json();
            renderGallery(data.images);
        }

        function renderGallery(images) {
            galleryGrid.innerHTML = '';
            images.forEach(img => {
                const div = document.createElement('div');
                div.style.position = 'relative';
                div.innerHTML = `
                    <img src="${img.src}" style="width:100%; height:100px; object-fit:cover; border-radius:4px;">
                    <button onclick="deleteImage('${img.src}')" style="position:absolute; top:5px; right:5px; background:red; color:white; border:none; border-radius:3px; cursor:pointer;">X</button>
                    <div style="font-size:10px; margin-top:2px;">${img.times.join(', ')}</div>
                `;
                galleryGrid.appendChild(div);
            });
        }

        window.openGalleryModal = () => {
            galleryForm.reset();
            galleryModal.style.display = 'block';
        }

        window.closeGalleryModal = () => {
            galleryModal.style.display = 'none';
        }

        galleryForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const fileInput = document.getElementById('gallery-file');
            const file = fileInput.files[0];
            if (!file) return;

            const times = [];
            if (document.getElementById('time-sabah').checked) times.push('sabah');
            if (document.getElementById('time-oglen').checked) times.push('oglen');
            if (document.getElementById('time-aksam').checked) times.push('aksam');

            if (times.length === 0) {
                alert('L√ºtfen en az bir zaman dilimi se√ßin.');
                return;
            }

            const formData = new FormData();
            formData.append('image', file);
            formData.append('times', JSON.stringify(times));

            try {
                const res = await fetch(`${API_URL}/gallery`, {
                    method: 'POST',
                    headers: { 'Authorization': `Bearer ${token}` },
                    body: formData
                });

                if (res.ok) {
                    closeGalleryModal();
                    loadGallery();
                } else {
                    alert('Y√ºkleme ba≈üarƒ±sƒ±z.');
                }
            } catch (err) {
                console.error(err);
            }
        });

        // Deprecated window.addNewCategory in favor of openCategoryModal
        // window.addNewCategory = ... removed

        window.deleteImage = async (src) => {
            if (!confirm('Bu fotoƒürafƒ± silmek istediƒüinize emin misiniz?')) return;
            try {
                const res = await fetch(`${API_URL}/gallery`, {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({ src })
                });
                if (res.ok) loadGallery();
            } catch (err) { console.error(err); }
        }

    </script>

    <div
        style="position: fixed; bottom: 20px; right: 20px; background: #fff; padding: 15px; border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.2); font-size: 13px; z-index: 1000; border-left: 5px solid #FFC700; font-family: 'Arial', sans-serif;">
        <div style="font-weight: bold; margin-bottom: 8px; font-size: 14px; color: #333;">Teknik Destek</div>
        <div style="border-top: 1px solid #eee; margin-bottom: 8px;"></div>
        <div style="margin-bottom: 4px;"><strong>Lemar Men√º Sistemi</strong></div>
        <div style="margin-bottom: 4px; color: #666;">Geli≈ütirici: Efkan Topcu</div>
        <div>üìû <a href="tel:05444702651" style="text-decoration: none; color: #333; font-weight: bold;">0544 470
                2651</a></div>
    </div>
</body>

</html>